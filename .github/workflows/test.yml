name: test

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

env:
  # Customize the CMake build type here (Release, Debug, RelWithDebInfo, etc.)
  BUILD_TYPE: Release

jobs:
  build:
    if: >
      github.repository == 'DataMedSci/gi-yagit' &&
      !contains(github.event.head_commit.message, '[ci skip]') &&
      !contains(github.event.head_commit.message, '[skip ci]')
    name: Build yagit
    runs-on: ubuntu-latest

    strategy:
      matrix:
        gamma-version:
          - "SEQUENTIAL"
          - "THREADED"

    steps:
    - uses: actions/checkout@v2

    - name: Check versions
      run: |
        gcc --version
        g++ --version
        cmake --version

    - name: Install dependencies
      run: |
        sudo apt update
        sudo apt install libgdcm-dev

    - name: Configure and build with CMake
      working-directory: ${{github.workspace}}/new
      run: |
        mkdir build && cd build
        cmake .. -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}} -DGAMMA_VERSION=${{matrix.gamma-version}} -DBUILD_EXAMPLES=ON
        cmake --build .

    - name: Run example
      working-directory: ${{github.workspace}}/new/build
      run: |
        ./examples/gammaImage
